<!-- Project nav -->
<nav class="wrapper project-nav">
	<ul>
		<li><a href="#/projects/{{ project.id }}/dashboard">Dashboard</a></li>
		<li class="active"><a href="#/projects/{{ project.id }}/tasks">Tasks</a></li>
		<li><a href="#/projects/{{ project.id }}/planning">Planning</a></li>
		<li><a href="#/projects/{{ project.id }}/files">Files</a></li>
		<li><a href="#/projects/{{ project.id }}/research">Research</a></li>
	</ul>
</nav>

<!-- Create task : form -->
<div class="wrapper task-create">
	
	<!-- NOTIFICATION CENTER -->
	<hr>
	<br>
	<ul>
		<li ng-repeat="alert in project.alerts | unseen"><b>{{ alert.id }}</b>: {{ alert.text }} <a ng-click="seen(alert.id)">Mark as read</a></li>
	</ul>
	<p>
		<a ng-click="alert('test')">Test</a>
	</p>
	<br>
	<hr>


	<form ng-submit="createTask()" class="task-form">
		<textarea ng-Model="newTask.name"class="task-text" placeholder="Enter your task here with some #hastags"></textarea>
		<div class="form-element task-assignment-wrapper">
			<!--<ul class="task-assignment">
				<li ng-repeat="user in project.users">
					<a href="">{{ user.uid | DropboxUIDToUsername: project.slug }}</a>
				</li>
			</ul>-->
			<label ng-repeat="user in project.users" class="task-assignment">
				<input
					type="checkbox"
					name="taskUsers"
					value="{{ user.uid }}"
					class="task-assignment-checkbox"
					ng-checked="userSelection.indexOf(user.uid) > -1"
					ng-click="toggleSelection(user.uid)"
				> <span>{{ user.uid | DropboxUIDToUsername: project.slug }}</span>
			</label>
		</div>
		<div class="task-from form-element">
			<input ng-Model="newTask.start" type="text" placeholder="yyyy-mm-dd" pattern="^[0-9]{4}-(?:[0]?[0-9]{1}|10|11|12)-(?:[012]?[0-9]{1}|30|31)$">
		</div>
		<div class="task-to form-element">
			<input ng-Model="newTask.end" type="text" placeholder="yyyy-mm-dd" pattern="^[0-9]{4}-(?:[0]?[0-9]{1}|10|11|12)-(?:[012]?[0-9]{1}|30|31)$">
		</div>
		<div class="task-buttons">
			<div class="task-button-priority">
				<!--<input ng-Model="newTask.priority" type="checkbox" class="task-checkbox-priority">
				<label></label>-->
				<input ng-Model="newTask.priority" type="checkbox" name="priority" id="priority" class="task-checkbox-priority">
        		<label for="priority" class="task-priority-label">⚠</label>
			</div>
			<button type="submit" class="task-submit">ADD THE TASK</button>
		</div>
	</form>
	<h2>All Tasks </h2>
	<div class="task-sort"></div>
	<!--<form ng-submit="createTask()" class="input-text">
		<label for="taskName">Task name :</label>
		<input name="taskName" ng-Model="newTask.name" type="text"><br/>

		<label for="taskStatus">Task status :</label>
		<select name="taskStatus" ng-Model="newTask.status">
			<option ng-selected="true">To do</option>
			<option>Started</option>
			<option>Advanced</option>
			<option>Done</option>
			<option>Verified (archived)</option>
		</select><br/>

		<label for="taskPriority">Is this task a priority ?</label>
		<input name="taskPriority" ng-Model="newTask.priority" type="checkbox"><br/>

		<label for="taskstart">Begin date :</label>
		<input name="taskstart" ng-Model="newTask.start" type="text" placeholder="yyyy-mm-dd" pattern="^[0-9]{4}-(?:[0]?[0-9]{1}|10|11|12)-(?:[012]?[0-9]{1}|30|31)$"><br/>

		<label for="taskend">End date :</label>
		<input name="taskend" ng-Model="newTask.end" type="text" placeholder="yyyy-mm-dd" pattern="^[0-9]{4}-(?:[0]?[0-9]{1}|10|11|12)-(?:[012]?[0-9]{1}|30|31)$"><br/>
			
		<label for="taskTags">Tags (separate the differents tags with a coma (,) ):</label>
		<input name="taskTags" ng-Model="newTask.tags" type="text"><br/>

		<label for="taskUsers">Who to assign this task to ?</label>
		<select multiple ng-Model="newTask.users">
			<option ng-repeat="user in project.users" value="{{ user.uid }}">{{ user.uid | DropboxUIDToUsername: project.slug }}</option>
		</select><br/>
		<ul>
			<li ng-if="newTask.users" ng-repeat="user in newTask.users">
				[ <a href="" ng-click="newTask.users.splice($index, 1)">X</a> ] - {{ user | DropboxUIDToUsername: project.slug }}
			</li>
		</ul>

		<input type="submit" value="Add the new task">
	</form>
	
	<span>Filter by :</span>
	<select id="searchByUser" multiple ng-model="tasksFilter">
		<option value="">All tasks</option>
		<option ng-repeat="user in project.users" value="{{ user.uid }}">{{ user.uid | DropboxUIDToUsername: project.slug }}</option>
	</select>-->
</div>

<!-- Task display -->
<div class="wrapper task-display">
	<ul class="view-mode">
		<li class="wrapper task-item" ng-repeat="task in project.tasks | filter:{users:tasksFilter} | orderBy: 'task.priority':true" ng-controller="TaskCtrl" >
			<!-- Task display (Hide on edit) -->
			<div ng-show="!edit_mode">	
				<!-- First line -->
				<div class="task-left">
					<h3 class="task-title">{{ task.name }}</h3>
					<ul class="task-tag-list">
						<li ng-repeat="tag in task.tags">
							<a href="">{{ tag }}</a>
						</li>
					</ul>
					<time class="task-dateCreation italic">{{ task.dateCreation }}</time>
				</div>
				
				<!-- Second line -->
				<div class="task-second-line">
					Assigned to <span ng-repeat="user in task.users" class="task-users bold">{{ user | DropboxUIDToUsername: project.slug }}, </span> due to <span class="bold">{{ task.end | smartDate }}</span>
				</div>
				
				<div class="dropdown-wrapper" ng-click="dropdown = !dropdown">
					<p>{{ task.status }}</p>	
					<ul class="task-status dropdown" name="taskStatus" ng-class="{'active': dropdown == true}">
						<li class="status-todo">To do</li>
						<li class="status-started">Started</li>
						<li class="status-advanced">Advanced</li>
						<li class="status-done">Done</li>
						<li class="status-verified">Verified</li>
					</ul>
				</div>
				<a class="action-link" href="" ng-click="toggleEditMode()">Edit</a>

				<!--<p class="red" ng-show="{{ task.priority }}">This task is a priority !</p>
				<a class="action-link" href="" ng-click="openCommentsFromTask()">Comment</a>
				
				<a class="action-link" href="" ng-click="deleteTask()">Delete</a>-->
			</div>
			
			<!-- Task Edit -->
			<div ng-show="edit_mode">
				<label for="taskName">Task name : ({{ task.name }})</label><br/>
				<input name="taskName" ng-Model="taskEdit.name" type="text"><br/><br/>
					
				<label for="taskStatus">Task status :</label><br/>
				<select name="taskStatus" ng-Model="taskEdit.status">
					<option ng-selected="true">To do</option>
					<option>Started</option>
					<option>Advanced</option>
					<option>Done</option>
					<option>Verified (archived)</option>
				</select><br/><br/>
					
				<label for="taskPriority">Is this task a priority ?</label>
				<input name="taskPriority" ng-Model="taskEdit.priority" type="checkbox"><br/><br/>
					
				<label for="taskstart">Begin date :</label><br/>
				<input name="taskstart" ng-Model="taskEdit.start" type="text" value="{{ task.start }}" placeholder="yyyy-mm-dd" pattern="^[0-9]{4}-(?:[0]?[0-9]{1}|10|11|12)-(?:[012]?[0-9]{1}|30|31)$"><br/><br/>
					
				<label for="taskend">End date :</label><br/>
				<input name="taskend" ng-Model="taskEdit.end" type="text" value="{{ task.end }}" placeholder="yyyy-mm-dd" pattern="^[0-9]{4}-(?:[0]?[0-9]{1}|10|11|12)-(?:[012]?[0-9]{1}|30|31)$"><br/><br/>
								
				<label for="taskTags">Tags (separate the differents tags with a coma (,) ):</label><br/>
				<input name="taskTags" ng-Model="taskEdit.tags" type="text" value="{{ task.tags }}"><br/><br/>
					
				<label for="taskUsers">Who to assign this task to ?</label><br/>
				<select multiple ng-Model="taskEdit.users">
					<option ng-repeat="user in project.users" value="{{ user.uid }}">{{ user.uid | DropboxUIDToUsername: project.slug }}</option>
				</select><br/>
				<ul>
					<li ng-if="taskEdit.users" ng-repeat="user in taskEdit.users">
						[ <a href="" ng-click="taskEdit.users.splice($index, 1)">X</a> ] - {{ user | DropboxUIDToUsername: project.slug }}
					</li>
				</ul><br/>
			
				<a class="action-link" href="" ng-click="toggleEditMode()">Cancel edit</a>
				<a class="action-link" href="" ng-click="deleteTask()">Delete task</a>
								
				<input type="submit" value="Update task" ng-click="editTask()">
			</div>
		</li>
	</ul>
</div>